////  HLCache.m//  Hooli////  Created by Er Li on 11/13/14.//  Copyright (c) 2014 ErLi. All rights reserved.//#import "HLCache.h"#import "HLConstant.h"#import <Foundation/Foundation.h>@interface HLCache()@property (nonatomic, strong) NSCache *cache;@end@implementation HLCache@synthesize cache;+ (id)sharedCache {    static dispatch_once_t pred = 0;    __strong static id _sharedObject = nil;    dispatch_once(&pred, ^{        _sharedObject = [[self alloc] init];    });    return _sharedObject;}- (id)init {    self = [super init];    if (self) {        self.cache = [[NSCache alloc] init];    }    return self;}#pragma mark - PAPCache- (void)clear {        [self.cache removeAllObjects];    }-(void)setLikedOffersByUser:(PFUser *)user likedOffers:(NSArray *)likedOffers{        NSDictionary *attributes = [NSDictionary dictionaryWithObjectsAndKeys:                                likedOffers,kHLOfferAttributesLikersKey,                                nil];    [self setAttributes:attributes forUser:user];    }- (void)setAttributesForOffer:(OfferModel *)offer likers:(NSArray *)likers likedByCurrentUser:(BOOL)likedByCurrentUser {        NSDictionary *attributes = [NSDictionary dictionaryWithObjectsAndKeys:                                [NSNumber numberWithBool:likedByCurrentUser],kHLOfferAttributesIsLikedByCurrentUserKey,                                @([likers count]),kHLOfferAttributesLikeCountKey,                                likers,kHLOfferAttributesLikersKey,                                nil];    [self setAttributes:attributes forOffer:offer];}- (void)incrementLikerCountForPhoto:(OfferModel *)offer {    NSNumber *likerCount = [NSNumber numberWithInt:[[self likeCountForOffer:offer] intValue] + 1];    NSMutableDictionary *attributes = [NSMutableDictionary dictionaryWithDictionary:[self attributesForOffer:offer]];    [attributes setObject:likerCount forKey:kHLOfferAttributesLikeCountKey];    [self setAttributes:attributes forOffer:offer];}- (void)decrementLikerCountForPhoto:(OfferModel *)offer {    NSNumber *likerCount = [NSNumber numberWithInt:[[self likeCountForOffer:offer] intValue] - 1];    if ([likerCount intValue] < 0) {        return;    }    NSMutableDictionary *attributes = [NSMutableDictionary dictionaryWithDictionary:[self attributesForOffer:offer]];    [attributes setObject:likerCount forKey:kHLOfferAttributesLikeCountKey];    [self setAttributes:attributes forOffer:offer];}- (NSDictionary *)attributesForOffer:(OfferModel *)offer {    NSString *key = [self keyForOffer:offer];    return [self.cache objectForKey:key];}- (NSString *)keyForOffer:(OfferModel *)offer {    return [NSString stringWithFormat:@"offer_%@", offer.offerId];}- (void)setAttributes:(NSDictionary *)attributes forOffer:(OfferModel *)offer {    NSString *key = [self keyForOffer:offer];    [self.cache setObject:attributes forKey:key];}- (void)setAttributes:(NSDictionary *)attributes forUser:(PFUser *)user {    NSString *key = [self keyForUser:user];    [self.cache setObject:attributes forKey:key];}- (NSString *)keyForUser:(PFUser *)user {        return [NSString stringWithFormat:@"user_%@", user.objectId];    }- (NSNumber *)likeCountForOffer:(OfferModel *)offer {    NSDictionary *attributes = [self attributesForOffer:offer];    if (attributes) {        return [attributes objectForKey:kHLOfferAttributesLikeCountKey];    }        return [NSNumber numberWithInt:0];}- (NSDictionary *)attributesForUser:(PFUser *)user {    NSString *key = [self keyForUser:user];    return [self.cache objectForKey:key];}- (void)setFollowStatus:(BOOL)following user:(PFUser *)user {        NSMutableDictionary *attributes = [NSMutableDictionary dictionaryWithDictionary:[self attributesForUser:user]];        [attributes setObject:[NSNumber numberWithBool:following] forKey:kHLUserAttributesIsFollowedByCurrentUserKey];    [self setAttributes:attributes forUser:user];    }- (BOOL)followStatusForUser:(PFUser *)user {    NSDictionary *attributes = [self attributesForUser:user];    if (attributes) {        NSNumber *followStatus = [attributes objectForKey:kHLUserAttributesIsFollowedByCurrentUserKey];        if (followStatus) {            return [followStatus boolValue];        }    }        return NO;}- (void)setFacebookFriends:(NSArray *)friends {    NSString *key = kHLUserDefaultsCacheFacebookFriendsKey;    [self.cache setObject:friends forKey:key];    [[NSUserDefaults standardUserDefaults] setObject:friends forKey:key];    [[NSUserDefaults standardUserDefaults] synchronize];}- (NSArray *)facebookFriends {        NSString *key = kHLUserDefaultsCacheFacebookFriendsKey;    if ([self.cache objectForKey:key]) {        return [self.cache objectForKey:key];    }        NSArray *friends = [[NSUserDefaults standardUserDefaults] objectForKey:key];        if (friends) {        [self.cache setObject:friends forKey:key];    }        return friends;}@end